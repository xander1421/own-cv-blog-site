---
import BaseLayout from '../layouts/BaseLayout.astro';
import BlackHole from '../components/BlackHole.astro';
---

<BaseLayout
  title="Chatter - Private Encrypted Messaging with Sealed Sender & Metadata Protection"
  description="End-to-end encrypted messaging that protects your metadata, not just content. No phone number required. Sealed Sender, anonymous inboxes, and local AI search. Open source."
  image="/chatter-og.png"
  type="website"
>
  <div class="waitlist-container">
    <!-- Hero Section with Blackhole Effect -->
    <section class="hero-section">
      <canvas id="blackhole-canvas" class="blackhole-canvas"></canvas>
      
      <div class="hero-content">
        <!-- Problem-focused headline -->
        <div class="hero-header">
          <div class="logo-container">
            <h1 class="logo-text">CHATTER</h1>
            <div class="logo-pulse"></div>
          </div>
          <h2 class="tagline">Your messages are encrypted.<br/><span class="highlight">But your metadata isn't.</span></h2>
        </div>

        <p class="hero-description">
          Most "secure" messengers encrypt content but leak who you talk to, when, and how often.
          Chatter uses <strong>Sealed Sender</strong> and <strong>anonymous inboxes</strong> so even we can't see your social graph.
        </p>

        <!-- Waitlist Form - moved up for conversion -->
        <div class="waitlist-form-container">
          <div class="social-proof">
            <span class="proof-count" id="waitlist-count">Join</span>
            <span class="proof-text">privacy-focused users waiting for launch</span>
          </div>

          <form id="waitlist-form" class="waitlist-form">
            <div class="input-group">
              <input
                type="email"
                id="email"
                name="email"
                placeholder="your@email.com"
                class="email-input"
                required
                pattern="[a-z0-9._%+\-]+@[a-z0-9.\-]+\.[a-z]{2,}$"
              />
              <button type="submit" class="submit-btn">
                <span class="btn-text">Get Early Access</span>
                <svg class="btn-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                  <polyline points="12 5 19 12 12 19"></polyline>
                </svg>
              </button>
            </div>
            <div id="form-message" class="form-message"></div>
          </form>
          <p class="form-note">No spam. Unsubscribe anytime. We don't sell your email (obviously).</p>
        </div>

        <!-- 4 Key Differentiators -->
        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                <path d="M9 12l2 2 4-4"/>
              </svg>
            </div>
            <h3>Sealed Sender</h3>
            <p>The server never sees who sent a message. Only the recipient can decrypt the sender's identity.</p>
          </div>

          <div class="feature-card">
            <div class="feature-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <circle cx="12" cy="16" r="1"/>
                <path d="M7 11V7a5 5 0 0110 0v4"/>
              </svg>
            </div>
            <h3>No Phone Number</h3>
            <p>No phone, no email—just a username. Your real identity stays completely separate from your account.</p>
          </div>

          <div class="feature-card">
            <div class="feature-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
                <path d="M8 10h.01M12 10h.01M16 10h.01"/>
              </svg>
            </div>
            <h3>Anonymous Inbox</h3>
            <p>Ephemeral mailboxes with blind signatures defeat traffic analysis attacks.</p>
          </div>

          <div class="feature-card">
            <div class="feature-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
              </svg>
            </div>
            <h3>Local AI Search</h3>
            <p>Search and summarize your messages with Ollama. All AI runs locally—nothing leaves your device.</p>
          </div>
        </div>

      </div>
    </section>

    <!-- Beyond Encryption Section -->
    <section class="beyond-section">
      <h2 class="section-title">Beyond Encryption</h2>
      <p class="section-subtitle">Encryption protects your content. We protect everything else.</p>

      <div class="beyond-grid">
        <div class="beyond-card">
          <div class="beyond-number">01</div>
          <h3>Hide Your Social Graph</h3>
          <p>Who you talk to is as sensitive as what you say. Sealed Sender ensures the server never knows who sent a message—only the recipient can decrypt the sender's identity.</p>
        </div>

        <div class="beyond-card">
          <div class="beyond-number">02</div>
          <h3>Defeat Traffic Analysis</h3>
          <p>Anonymous inboxes with blind signatures break the correlation between sender and recipient. Your communication patterns stay invisible.</p>
        </div>

        <div class="beyond-card">
          <div class="beyond-number">03</div>
          <h3>No Identity Anchors</h3>
          <p>Create an account with just a username. No phone number, no email required. Your real identity stays completely separate from your Chatter identity.</p>
        </div>

        <div class="beyond-card">
          <div class="beyond-number">04</div>
          <h3>AI Without Surveillance</h3>
          <p>Search and summarize your messages with local AI. Ollama runs on your device—your data never touches our servers or any cloud.</p>
        </div>
      </div>
    </section>

    <!-- Technical Details Section -->
    <section class="tech-section">
      <h2 class="section-title">How It Works</h2>

      <div class="tech-grid">
        <div class="tech-card">
          <h3>Signal Protocol Encryption</h3>
          <p>X3DH key exchange, Double Ratchet algorithm, and ChaCha20-Poly1305 encryption. The same cryptographic foundation trusted by billions.</p>
        </div>

        <div class="tech-card">
          <h3>Zero-Knowledge Architecture</h3>
          <p>SQLCipher encrypted local storage, privacy-preserving typing indicators, and anonymous read receipts. We can't read your data—by design.</p>
        </div>

        <div class="tech-card">
          <h3>Native Performance</h3>
          <p>Built in Rust with Slint UI—no browser engine, no Electron. Lightweight with native Wayland support on Linux.</p>
          <a href="/blog/from-react-to-rust-native-journey" class="tech-link">Why we chose Rust →</a>
        </div>

        <div class="tech-card">
          <h3>Voice & Video</h3>
          <p>Encrypted calls with LiveKit WebRTC. Screen sharing, participant grid, and low-latency audio.</p>
        </div>
      </div>

      <div class="open-source-banner">
        <div class="os-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
        </div>
        <div class="os-text">
          <strong>100% Open Source</strong>
          <span>Audit the code yourself. GPL-3.0 licensed.</span>
        </div>
        <a href="https://github.com/xander1421/chatter" class="os-link">View on GitHub →</a>
      </div>
    </section>

    <!-- Footer -->
    <footer class="waitlist-footer">
      <p>© 2026 Chatter. Built with passion by <a href="/" class="footer-link">Alexandru Pruteanu</a></p>
      <div class="footer-links">
        <a href="/blog" class="footer-link">Blog</a>
        <a href="https://github.com/xander1421" class="footer-link">GitHub</a>
        <a href="https://linkedin.com/in/alexandru-prt" class="footer-link">LinkedIn</a>
      </div>
    </footer>
  </div>
</BaseLayout>

<style>
  /* Override BaseLayout main constraints for this page */
  :global(main) {
    max-width: none !important;
    padding: 0 !important;
    margin: 0 !important;
    width: 100vw !important;
    margin-left: calc(-50vw + 50%) !important;
  }

  /* Hide BaseLayout background effects */
  :global(.matrix-background),
  :global(.perspective-grid),
  :global(.data-streams),
  :global(.scanlines),
  :global(.hologram-grid),
  :global(.glitch-overlay),
  :global(.noise),
  :global(body::before) {
    display: none !important;
  }

  /* Override body background */
  :global(body) {
    background: #000000 !important;
  }

  .waitlist-container {
    min-height: 100vh;
    background: #000000;
    color: #ffffff;
    overflow-x: hidden;
    width: 100%;
  }

  /* Hero Section */
  .hero-section {
    position: relative;
    z-index: 1;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }

  /* Full viewport black hole canvas */
  .blackhole-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 0;
    opacity: 0.8;
  }

  .hero-content {
    position: relative;
    z-index: 10;
    max-width: 1200px;
    width: 100%;
    text-align: center;
  }

  .hero-header {
    background: rgba(0, 0, 0, 0.7);
    padding: 2rem 3rem;
    border-radius: 20px;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    display: inline-block;
    margin-bottom: 2rem;
    border: 1px solid rgba(102, 126, 234, 0.2);
    box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5);
  }

  .logo-container {
    position: relative;
    display: inline-block;
    margin-bottom: 1rem;
  }

  .logo-text {
    font-size: 5rem;
    font-weight: 900;
    letter-spacing: 0.1em;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin: 0;
    animation: glow 3s ease-in-out infinite;
  }

  @keyframes glow {
    0%, 100% { filter: drop-shadow(0 0 20px rgba(102, 126, 234, 0.5)); }
    50% { filter: drop-shadow(0 0 40px rgba(240, 147, 251, 0.8)); }
  }

  .logo-pulse {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 150%;
    height: 150%;
    background: radial-gradient(circle, rgba(102, 126, 234, 0.2) 0%, transparent 70%);
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.2; }
  }

  .tagline {
    font-size: 1.5rem;
    font-weight: 300;
    margin: 0;
    color: #c0c0c0;
    line-height: 1.4;
  }

  .tagline .highlight {
    color: #f093fb;
    font-weight: 500;
  }

  .hero-description {
    font-size: 1.25rem;
    line-height: 1.8;
    max-width: 700px;
    margin: 0 auto 3rem;
    color: #e0e0e0;
    background: rgba(0, 0, 0, 0.6);
    padding: 1.5rem 2rem;
    border-radius: 12px;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }

  /* Features Grid */
  .features-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    margin-top: 3rem;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }

  @media (max-width: 600px) {
    .features-grid {
      grid-template-columns: 1fr;
    }
  }

  .feature-card {
    background: rgba(0, 0, 0, 0.7);
    border: 1px solid rgba(102, 126, 234, 0.2);
    border-radius: 16px;
    padding: 1.5rem;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
    text-align: left;
  }

  .feature-card:hover {
    background: rgba(0, 0, 0, 0.8);
    border-color: rgba(102, 126, 234, 0.5);
    transform: translateY(-2px);
    box-shadow: 0 8px 40px rgba(102, 126, 234, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  .feature-icon {
    margin-bottom: 0.75rem;
    color: #a5b4fc;
  }

  .feature-icon svg {
    width: 32px;
    height: 32px;
  }

  .feature-card h3 {
    font-size: 1rem;
    margin-bottom: 0.5rem;
    color: #ffffff;
    font-weight: 600;
  }

  .feature-card p {
    font-size: 0.85rem;
    color: #999;
    line-height: 1.5;
    margin: 0;
  }

  /* Waitlist Form */
  .waitlist-form-container {
    max-width: 480px;
    margin: 2rem auto 0;
    padding: 2rem;
    background: rgba(0, 0, 0, 0.8);
    border: 1px solid rgba(102, 126, 234, 0.3);
    border-radius: 20px;
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    box-shadow: 0 8px 40px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.05);
  }

  .form-title {
    font-size: 1.8rem;
    margin-bottom: 0.5rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .form-subtitle {
    color: #b0b0b0;
    margin-bottom: 2rem;
  }

  .social-proof {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .proof-count {
    font-size: 1.1rem;
    font-weight: 700;
    background: linear-gradient(135deg, #667eea 0%, #f093fb 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .proof-text {
    color: #888;
    font-size: 0.95rem;
  }

  .form-note {
    margin-top: 1rem;
    font-size: 0.8rem;
    color: #666;
  }

  .input-group {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .email-input {
    flex: 1;
    padding: 1rem 1.5rem;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(102, 126, 234, 0.2);
    border-radius: 12px;
    color: #ffffff;
    font-size: 1rem;
    transition: all 0.3s ease;
  }

  .email-input::placeholder {
    color: #888888;
  }

  .email-input:focus {
    outline: none;
    background: rgba(0, 0, 0, 0.8);
    border-color: rgba(102, 126, 234, 0.5);
    box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
  }

  .submit-btn {
    padding: 1rem 2rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 12px;
    color: #ffffff;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .submit-btn:hover {
    transform: translateX(4px);
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
  }

  .btn-arrow {
    transition: transform 0.3s ease;
  }

  .submit-btn:hover .btn-arrow {
    transform: translateX(4px);
  }

  .form-message {
    text-align: center;
    font-size: 0.95rem;
    padding: 0.75rem;
    border-radius: 8px;
    display: none;
  }

  .form-message.success {
    display: block;
    background: rgba(74, 222, 128, 0.1);
    border: 1px solid rgba(74, 222, 128, 0.3);
    color: #4ade80;
  }

  .form-message.error {
    display: block;
    background: rgba(248, 113, 113, 0.1);
    border: 1px solid rgba(248, 113, 113, 0.3);
    color: #f87171;
  }

  /* Stats Container */
  .stats-container {
    display: flex;
    justify-content: center;
    gap: 4rem;
    margin-top: 3rem;
  }

  .stat {
    text-align: center;
  }

  .stat-number {
    display: block;
    font-size: 2.5rem;
    font-weight: 700;
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .stat-label {
    display: block;
    font-size: 0.9rem;
    color: #666666;
    margin-top: 0.5rem;
  }

  /* Beyond Section */
  .beyond-section {
    position: relative;
    z-index: 10;
    padding: 5rem 2rem;
    max-width: 1200px;
    margin: 0 auto;
    background: rgba(0, 0, 0, 0.9);
  }

  .section-subtitle {
    text-align: center;
    color: #888;
    font-size: 1.2rem;
    margin-top: -2rem;
    margin-bottom: 3rem;
  }

  .beyond-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
  }

  .beyond-card {
    padding: 2rem;
    border-left: 2px solid rgba(102, 126, 234, 0.4);
    transition: all 0.3s ease;
  }

  .beyond-card:hover {
    border-left-color: #f093fb;
    background: rgba(102, 126, 234, 0.05);
  }

  .beyond-number {
    font-size: 0.85rem;
    font-weight: 700;
    color: #667eea;
    margin-bottom: 0.75rem;
    letter-spacing: 0.1em;
  }

  .beyond-card h3 {
    font-size: 1.3rem;
    margin-bottom: 0.75rem;
    color: #fff;
  }

  .beyond-card p {
    color: #999;
    line-height: 1.7;
    font-size: 0.95rem;
  }

  /* Tech Section */
  .tech-section {
    position: relative;
    z-index: 10;
    padding: 5rem 2rem;
    max-width: 1200px;
    margin: 0 auto;
    background: rgba(0, 0, 0, 0.85);
  }

  .section-title {
    font-size: 3rem;
    text-align: center;
    margin-bottom: 3rem;
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .tech-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 4rem;
  }

  .tech-card {
    background: rgba(0, 0, 0, 0.7);
    border: 1px solid rgba(240, 147, 251, 0.2);
    border-radius: 16px;
    padding: 2rem;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
  }

  .tech-card:hover {
    background: rgba(0, 0, 0, 0.8);
    border-color: rgba(240, 147, 251, 0.5);
    box-shadow: 0 8px 40px rgba(240, 147, 251, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  .tech-card h3 {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    color: #ffffff;
  }

  .tech-card p {
    color: #b0b0b0;
    line-height: 1.7;
    margin-bottom: 1rem;
  }

  .tech-link {
    color: #667eea;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s ease;
  }

  .tech-link:hover {
    color: #f093fb;
  }

  .tech-stack {
    text-align: center;
    margin-top: 4rem;
  }

  .tech-stack h3 {
    font-size: 1.5rem;
    margin-bottom: 2rem;
    color: #ffffff;
  }

  .tech-badges {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1rem;
  }

  .tech-badge {
    padding: 0.5rem 1.5rem;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(102, 126, 234, 0.4);
    border-radius: 25px;
    font-size: 0.9rem;
    color: #a5b4fc;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    transition: all 0.3s ease;
  }

  .tech-badge:hover {
    background: rgba(0, 0, 0, 0.8);
    border-color: rgba(102, 126, 234, 0.6);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
  }

  /* Open Source Banner */
  .open-source-banner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1.5rem;
    margin-top: 3rem;
    padding: 1.5rem 2rem;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(102, 126, 234, 0.3);
    border-radius: 12px;
    flex-wrap: wrap;
  }

  .os-icon {
    color: #a5b4fc;
  }

  .os-text {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .os-text strong {
    color: #fff;
    font-size: 1rem;
  }

  .os-text span {
    color: #888;
    font-size: 0.85rem;
  }

  .os-link {
    color: #667eea;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s ease;
    margin-left: auto;
  }

  .os-link:hover {
    color: #f093fb;
  }

  /* Footer */
  .waitlist-footer {
    position: relative;
    z-index: 10;
    padding: 3rem 2rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    text-align: center;
    color: #666666;
    background: rgba(0, 0, 0, 0.9);
  }

  .footer-links {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-top: 1rem;
  }

  .footer-link {
    color: #999999;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .footer-link:hover {
    color: #667eea;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .logo-text {
      font-size: 2.5rem;
    }

    .tagline {
      font-size: 1.2rem;
    }

    .hero-description {
      font-size: 1rem;
      padding: 1rem;
    }

    .features-grid {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .input-group {
      flex-direction: column;
    }

    .submit-btn {
      width: 100%;
      justify-content: center;
    }

    .tech-grid {
      grid-template-columns: 1fr;
    }

    .beyond-grid {
      grid-template-columns: 1fr;
    }

    .section-title {
      font-size: 2rem;
    }

    .section-subtitle {
      font-size: 1rem;
      margin-top: -1.5rem;
    }

    .open-source-banner {
      flex-direction: column;
      text-align: center;
    }

    .os-link {
      margin-left: 0;
    }
  }
</style>

<script>
  // Interstellar-style blackhole effect from Chatter frontend (converted to vanilla JS)
  const canvas = document.getElementById('blackhole-canvas') as HTMLCanvasElement;
  if (canvas) {
    const gl = canvas.getContext('webgl2', {
      alpha: true,
      antialias: false,
      powerPreference: 'low-power',
      preserveDrawingBuffer: false
    }) || canvas.getContext('webgl', {
      alpha: true,
      antialias: false,
      powerPreference: 'low-power',
      preserveDrawingBuffer: false
    });

    if (gl) {
      // Vertex shader
      const vertexShaderSource = `
        attribute vec2 a_position;
        varying vec2 v_uv;
        
        void main() {
          v_uv = a_position;
          gl_Position = vec4(a_position, 0.0, 1.0);
        }
      `;

      // Fragment shader - Optimized Interstellar black hole (reduced iterations for performance)
      const fragmentShaderSource = `
        precision highp float;

        varying vec2 v_uv;
        uniform float u_time;
        uniform vec2 u_resolution;

        #define AA 1
        #define _Speed 3.0
        #define _Steps 8.0
        #define _Size 0.4
        
        float hash(float x) { 
          return fract(sin(x) * 152754.742);
        }
        
        float hash(vec2 x) {    
          return hash(x.x + hash(x.y));
        }
        
        float value(vec2 p, float f) {
          float bl = hash(floor(p * f + vec2(0., 0.)));
          float br = hash(floor(p * f + vec2(1., 0.)));
          float tl = hash(floor(p * f + vec2(0., 1.)));
          float tr = hash(floor(p * f + vec2(1., 1.)));
          
          vec2 fr = fract(p * f);    
          fr = (3.0 - 2.0 * fr) * fr * fr;    
          float b = mix(bl, br, fr.x);    
          float t = mix(tl, tr, fr.x);
          return mix(b, t, fr.y);
        }
        
        vec4 background(vec3 ray) {
          vec2 uv = ray.xy;
          
          if (abs(ray.x) > 0.5)
            uv.x = ray.z;
          else if (abs(ray.y) > 0.5)
            uv.y = ray.z;
          
          float brightness = value(uv * 3.0, 100.0);
          float color = value(uv * 2.0, 20.0);
          brightness = pow(brightness, 256.0);
          brightness = brightness * 100.0;
          brightness = clamp(brightness, 0.0, 1.0);

          vec3 stars = brightness * mix(vec3(0.5, 0.5, 0.6), vec3(0.3, 0.3, 0.4), color) * 0.5;

          vec3 nebulae = vec3(0.0);
          float nebula = value(uv * 0.5, 5.0);
          nebula = pow(nebula, 8.0) * 0.02;
          nebulae = vec3(nebula) * vec3(0.2, 0.1, 0.3);

          return vec4(stars + nebulae, 1.0);
        }
        
        vec4 raymarchDisk(vec3 ray, vec3 zeroPos) {
          vec3 position = zeroPos;      
          float lengthPos = length(position.xz);
          float dist = min(1.0, lengthPos * (1.0 / _Size) * 0.5) * _Size * 0.4 * (1.0 / _Steps) / abs(ray.y);
          
          position += dist * _Steps * ray * 0.5;     
          
          vec2 deltaPos;
          deltaPos.x = -zeroPos.z * 0.01 + zeroPos.x;
          deltaPos.y = zeroPos.x * 0.01 + zeroPos.z;
          deltaPos = normalize(deltaPos - zeroPos.xz);
          
          float parallel = dot(ray.xz, deltaPos);
          parallel /= sqrt(lengthPos);
          parallel *= 0.5;
          float redShift = parallel + 0.3;
          redShift *= redShift;
          redShift = clamp(redShift, 0.0, 1.0);
          
          float disMix = clamp((lengthPos - _Size * 2.0) * (1.0 / _Size) * 0.24, 0.0, 1.0);
          vec3 insideCol = mix(vec3(0.9, 0.3, 0.9), vec3(0.3, 0.1, 0.3), disMix);
          
          insideCol *= mix(vec3(0.5, 0.3, 0.5), vec3(2.0, 1.0, 2.0), redShift);
          insideCol *= 1.0;
          redShift += 0.12;
          redShift *= redShift;
          
          vec4 o = vec4(0.0);
          
          for (float i = 0.0; i < _Steps; i++) {                      
            position -= dist * ray;  
            
            float intensity = clamp(1.0 - abs((i - 0.8) * (1.0 / _Steps) * 2.0), 0.0, 1.0); 
            float lengthPos = length(position.xz);
            float distMult = 1.0;
            
            distMult *= clamp((lengthPos - _Size * 0.75) * (1.0 / _Size) * 1.5, 0.0, 1.0);        
            distMult *= clamp((_Size * 10.0 - lengthPos) * (1.0 / _Size) * 0.20, 0.0, 1.0);
            distMult *= distMult;
            
            float u = lengthPos + u_time * _Size * 0.3 + intensity * _Size * 0.2;
            
            vec2 xy;
            float rot = mod(u_time * _Speed, 8192.0);
            xy.x = -position.z * sin(rot) + position.x * cos(rot);
            xy.y = position.x * sin(rot) + position.z * cos(rot);
            
            float x = abs(xy.x / xy.y);         
            float angle = 0.02 * atan(x);
            
            const float f = 70.0;
            float noise = value(vec2(angle, u * (1.0 / _Size) * 0.05), f);
            noise = noise * 0.66 + 0.33 * value(vec2(angle, u * (1.0 / _Size) * 0.05), f * 2.0);     
            
            float extraWidth = noise * 1.0 * (1.0 - clamp(i * (1.0 / _Steps) * 2.0 - 1.0, 0.0, 1.0));
            
            float alpha = clamp(noise * (intensity + extraWidth) * ((1.0 / _Size) * 10.0 + 0.01) * dist * distMult, 0.0, 1.0);
            
            vec3 col = 2.0 * mix(vec3(0.3, 0.2, 0.15) * insideCol, insideCol, min(1.0, intensity * 2.0));
            o = clamp(vec4(col * alpha + o.rgb * (1.0 - alpha), o.a * (1.0 - alpha) + alpha), vec4(0.0), vec4(1.0));
            
            lengthPos *= (1.0 / _Size);
            
            o.rgb += redShift * (intensity * 1.0 + 0.5) * (1.0 / _Steps) * 100.0 * distMult / (lengthPos * lengthPos);
          }  
          
          o.rgb = clamp(o.rgb - 0.005, 0.0, 1.0);
          return o;
        }
        
        void Rotate(inout vec3 vector, vec2 angle) {
          vector.yz = cos(angle.y) * vector.yz + sin(angle.y) * vec2(-1, 1) * vector.zy;
          vector.xz = cos(angle.x) * vector.xz + sin(angle.x) * vec2(-1, 1) * vector.zx;
        }
        
        void main() {
          vec4 colOut = vec4(0.0);
          
          vec2 fragCoord = gl_FragCoord.xy;
          
          vec2 fragCoordRot;
          fragCoordRot.x = fragCoord.x * 0.985 + fragCoord.y * 0.174;
          fragCoordRot.y = fragCoord.y * 0.985 - fragCoord.x * 0.174;
          fragCoordRot += vec2(-0.06, 0.12) * u_resolution.xy;
          
          for (int j = 0; j < AA; j++)
          for (int i = 0; i < AA; i++) {
            vec3 ray = normalize(vec3((fragCoordRot - u_resolution.xy * 0.5 + vec2(float(i), float(j)) / float(AA)) / u_resolution.x, 1.0)); 
            vec3 pos = vec3(0.0, 0.05, -10.0);
            vec2 angle = vec2(u_time * 0.1, 0.2);      
            angle.y = 3.14 + 0.1 + 3.14;
            float dist = length(pos);
            Rotate(pos, angle);
            angle.xy -= min(0.3 / dist, 3.14) * vec2(1.0, 0.5);
            Rotate(ray, angle);
            
            vec4 col = vec4(0.0); 
            vec4 glow = vec4(0.0); 
            vec4 outCol = vec4(100.0);
            
            for (int disks = 0; disks < 8; disks++) {
              for (int h = 0; h < 2; h++) {
                float dotpos = dot(pos, pos);
                float invDist = inversesqrt(dotpos);
                float centDist = dotpos * invDist;
                float stepDist = 0.92 * abs(pos.y / ray.y);
                float farLimit = centDist * 0.5;
                float closeLimit = centDist * 0.1 + 0.05 * centDist * centDist * (1.0 / _Size);
                stepDist = min(stepDist, min(farLimit, closeLimit));
                
                float invDistSqr = invDist * invDist;
                float bendForce = stepDist * invDistSqr * _Size * 0.625;
                ray = normalize(ray - (bendForce * invDist) * pos);
                pos += stepDist * ray; 
                
                glow += vec4(0.9, 0.3, 0.9, 1.0) * (0.01 * stepDist * invDistSqr * invDistSqr * clamp(centDist * 2.0 - 1.2, 0.0, 1.0));
              }
              
              float dist2 = length(pos);
              
              if (dist2 < _Size * 0.1) {
                outCol = vec4(col.rgb * col.a + glow.rgb * (1.0 - col.a), 1.0);
                break;
              }
              else if (dist2 > _Size * 1000.0) {                   
                vec4 bg = background(ray);
                outCol = vec4(col.rgb * col.a + bg.rgb * (1.0 - col.a) + glow.rgb * (1.0 - col.a), 1.0);       
                break;
              }
              else if (abs(pos.y) <= _Size * 0.002) {                             
                vec4 diskCol = raymarchDisk(ray, pos);
                pos.y = 0.0;
                pos += abs(_Size * 0.001 / ray.y) * ray;  
                col = vec4(diskCol.rgb * (1.0 - col.a) + col.rgb, col.a + diskCol.a * (1.0 - col.a));
              }    
            }
            
            if (outCol.r == 100.0)
              outCol = vec4(col.rgb + glow.rgb * (col.a + glow.a), 1.0);
            
            col = outCol;
            col.rgb = pow(col.rgb, vec3(0.6));
            
            colOut += col / float(AA * AA);
          }
          
          gl_FragColor = colOut;
        }
      `;

      // Compile shader function
      function compileShader(type: number, source: string): WebGLShader | null {
        const shader = gl.createShader(type);
        if (!shader) return null;
        
        gl.shaderSource(shader, source);
        gl.compileShader(shader);
        
        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
          console.error('Shader error:', gl.getShaderInfoLog(shader));
          gl.deleteShader(shader);
          return null;
        }
        
        return shader;
      }

      const vertexShader = compileShader(gl.VERTEX_SHADER, vertexShaderSource);
      const fragmentShader = compileShader(gl.FRAGMENT_SHADER, fragmentShaderSource);
      
      if (vertexShader && fragmentShader) {
        const program = gl.createProgram();
        if (program) {
          gl.attachShader(program, vertexShader);
          gl.attachShader(program, fragmentShader);
          gl.linkProgram(program);
          
          if (gl.getProgramParameter(program, gl.LINK_STATUS)) {
            // Setup geometry
            const positions = new Float32Array([
              -1, -1, 1, -1, -1, 1, 1, 1
            ]);
            
            const buffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
            gl.bufferData(gl.ARRAY_BUFFER, positions, gl.STATIC_DRAW);
            
            const positionLocation = gl.getAttribLocation(program, 'a_position');
            gl.enableVertexAttribArray(positionLocation);
            gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);
            
            const timeLocation = gl.getUniformLocation(program, 'u_time');
            const resolutionLocation = gl.getUniformLocation(program, 'u_resolution');
            
            gl.useProgram(program);
            
            let startTime = Date.now();
            let animationId: number;
            let isVisible = true;
            let isTabVisible = true;
            let lastFrameTime = 0;
            const targetFPS = 30; // Cap at 30fps for performance
            const frameInterval = 1000 / targetFPS;

            function resizeCanvas() {
              // Lower resolution for better GPU performance
              const scale = window.innerWidth > 768 ? 0.5 : 0.75;
              canvas.width = Math.floor(window.innerWidth * scale);
              canvas.height = Math.floor(window.innerHeight * scale);
            }

            function render(currentTime: number) {
              // Skip if tab or canvas not visible
              if (!isVisible || !isTabVisible) {
                animationId = requestAnimationFrame(render);
                return;
              }

              // Frame rate limiting
              const elapsed = currentTime - lastFrameTime;
              if (elapsed < frameInterval) {
                animationId = requestAnimationFrame(render);
                return;
              }
              lastFrameTime = currentTime - (elapsed % frameInterval);

              gl.viewport(0, 0, canvas.width, canvas.height);
              gl.uniform1f(timeLocation, (Date.now() - startTime) / 1000);
              gl.uniform2f(resolutionLocation, canvas.width, canvas.height);
              gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);

              animationId = requestAnimationFrame(render);
            }

            // Pause when canvas scrolled out of view
            const observer = new IntersectionObserver(
              (entries) => {
                isVisible = entries[0]?.isIntersecting ?? false;
              },
              { threshold: 0.1 }
            );
            observer.observe(canvas);

            // Pause when tab is not visible
            document.addEventListener('visibilitychange', () => {
              isTabVisible = !document.hidden;
            });

            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            requestAnimationFrame(render);
            
            // Cleanup on page navigation
            window.addEventListener('pagehide', () => {
              observer.disconnect();
              if (animationId) cancelAnimationFrame(animationId);
              gl.deleteProgram(program);
              gl.deleteShader(vertexShader);
              gl.deleteShader(fragmentShader);
              gl.deleteBuffer(buffer);
            });
          }
        }
      }
    }
  }

  // Waitlist form handler with Supabase
  const SUPABASE_URL = 'https://fsnwduufbbqxyylwzabg.supabase.co';
  const SUPABASE_ANON_KEY = 'sb_publishable_pKxCqZDi95BLe4rbTQOdrw_n-wmn17a';

  // Fetch waitlist count for social proof (only show if > 10)
  async function fetchWaitlistCount() {
    try {
      const response = await fetch(`${SUPABASE_URL}/rest/v1/waitlist?select=count`, {
        method: 'HEAD',
        headers: {
          'apikey': SUPABASE_ANON_KEY,
          'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
          'Prefer': 'count=exact'
        }
      });
      const count = parseInt(response.headers.get('content-range')?.split('/')[1] || '0');
      const countEl = document.getElementById('waitlist-count');
      if (countEl && count >= 10) {
        countEl.textContent = `${count}+`;
      }
    } catch (e) {
      // Silently fail - social proof is not critical
    }
  }
  fetchWaitlistCount();

  const form = document.getElementById('waitlist-form') as HTMLFormElement;
  const message = document.getElementById('form-message') as HTMLDivElement;
  const submitBtn = form?.querySelector('.submit-btn') as HTMLButtonElement;

  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const email = (formData.get('email') as string)?.toLowerCase().trim();

      if (!email) {
        message.textContent = 'Please enter a valid email address';
        message.className = 'form-message error';
        return;
      }

      // Disable button while submitting
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.querySelector('.btn-text')!.textContent = 'Joining...';
      }

      try {
        const response = await fetch(`${SUPABASE_URL}/rest/v1/waitlist`, {
          method: 'POST',
          headers: {
            'apikey': SUPABASE_ANON_KEY,
            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
            'Content-Type': 'application/json',
            'Prefer': 'return=minimal'
          },
          body: JSON.stringify({ email })
        });

        if (response.ok) {
          message.textContent = "Welcome aboard! We'll notify you when Chatter launches.";
          message.className = 'form-message success';
          form.reset();
        } else if (response.status === 409) {
          // Duplicate email (unique constraint violation)
          message.textContent = "You're already on the waitlist!";
          message.className = 'form-message error';
        } else {
          throw new Error('Failed to join waitlist');
        }
      } catch (error) {
        message.textContent = 'Something went wrong. Please try again.';
        message.className = 'form-message error';
      } finally {
        // Re-enable button
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.querySelector('.btn-text')!.textContent = 'Join Now';
        }
      }

      setTimeout(() => {
        message.className = 'form-message';
        message.textContent = '';
      }, 5000);
    });
  }
</script>